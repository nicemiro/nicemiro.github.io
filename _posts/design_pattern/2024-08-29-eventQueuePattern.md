---
title: Event Queue Pattern (이벤트 큐 패턴)
titleEn:
author: BabyK
date: 2024-08-29
category: Design_Pattern
tags: [DesignPattern]
layout: post
published: false
---
<br>

### 개념
이벤트의 발송 시점과 처리 시점을 디커플링한다.  
사실상 큐를 사용해 비동기 실행을 가능하게 한 옵저버 패턴이라고 볼 수 있음.

이벤트 루프가 돌고 있음 -> 사용자 입력이 들어옴 -> 큐에 저장 -> 이벤트 시스템이 원하는 시점에 처리  

이벤트를 큐에 모아 특정 시점에 순차적으로 실행가능. 큐에 있는 잡들의 조작또한 가능함.

메시지의 발송과 처리를 분리하고 싶다면 옵저버 패터을 사용해도 된다. 메시지큐 패턴을 사용하는 이유는 메시지를 보내는 시점과 받는 시점을 분리하기 위해서 이다.
이벤트를 발송하는 쪽에서는 이벤트를 큐에 넣고 실행을 기다리지 않고 돌아와 자기 할일을 수행할 수 있고, 처리하는 쪽에서도 직접 처리하거나 다른쪽으로 처리할 수 있는 등 이벤트의 발송과 처리를 확실하게 분리시켜 준다.

큐는 요청을 받는 쪽에 제어권을 제공한다. 따라서 보내는 쪽에서 처리 응답을 받아야 한다면 큐를 쓰는 게 적합하지 않다.  

주의 사항

1. 중앙 이벤트 큐를 사용한다면 이는 전역변수와 비슷하다

2. 
동기 이벤트가 아니기 때문에 발송했을때의 시점과 처리시점의 상태가 다를 수 있다. 때문에 메시지에 들어갈 발송시점의 일시적인 상태가 필요할 수 있고 데이터사이즈가 클 수도 있다.  

3. 큐 시스템이 비동기로 작동하기 때문에 순환루프에 빠지더라도 동지시스템에 비해 오류를 찾아내기 힘들 수 있다. 이 문제를 피하는 좋은 방법은 이벤트를 처리하는 코드에서는 이벤트를 보내지 않는 것이다. 


#### 예시
이벤트큐를 사용하지 않는다면 사운드 출력API의 경우 사운드가 출력되는 동안 리소스를 로딩에 스피커에서 출력할 때까지 API가 블록될 수 있다. 따라서 사운드 API가 큐에 작업을 넣고나서 바로 리턴하게 만들어야 하는데 그러자면 사운드 출력 작업을 지연시킬 수 있어야 한다.
멀티쓰레드 사용 - 큐가 동시에 수정되는 상황을 막으면 됨.


